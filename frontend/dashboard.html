<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autologist - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏</title>
    
    <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ Material Design -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #202124;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∏—Å—Ç–µ–º—ã */
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            color: #1a73e8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header p {
            color: #5f6368;
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 8px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .nav-tab {
            background: none;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #5f6368;
            transition: all 0.2s ease;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab:hover {
            background: rgba(26, 115, 232, 0.08);
            color: #1a73e8;
        }

        .nav-tab.active {
            background: #1a73e8;
            color: white;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
            min-height: 500px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            background: #1557b0;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }

        .btn-success {
            background: #34a853;
        }

        .btn-success:hover {
            background: #2d8f47;
        }

        .btn-danger {
            background: #ea4335;
        }

        .btn-danger:hover {
            background: #d23b2d;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid #1a73e8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .stat-card.success {
            border-left-color: #34a853;
        }

        .stat-card.warning {
            border-left-color: #fbbc04;
        }

        .stat-card.danger {
            border-left-color: #ea4335;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: #1a73e8;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #5f6368;
            font-size: 14px;
            font-weight: 500;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #202124;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e8eaed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #e8eaed;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #202124;
            font-size: 14px;
        }

        .table td {
            font-size: 14px;
            vertical-align: middle;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .info-card {
            background: #e8f4fd;
            border: 1px solid #d2e3fc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #1967d2;
            font-size: 16px;
        }

        .error-card {
            background: #fce8e6;
            border: 1px solid #f9ab00;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #d73027;
            font-size: 16px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                flex-direction: column;
                gap: 4px;
            }

            .nav-tab {
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="header">
            <h1>üöõ Autologist</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–æ–∫</p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
            <button class="nav-tab" data-tab="chats">üí¨ –ß–∞—Ç—ã</button>
            <button class="nav-tab" data-tab="chat-management">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏</button>
            <button class="nav-tab" data-tab="messages">üì® –°–æ–æ–±—â–µ–Ω–∏—è</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="tab-content">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div id="dashboard" class="tab-pane active">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-number" id="activeChats">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-number" id="todayMessages">0</div>
                        <div class="stat-label">–°–µ–≥–æ–¥–Ω—è —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-number" id="errorCount">0</div>
                        <div class="stat-label">–û—à–∏–±–æ–∫</div>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ -->
                <h3>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏</h3>
                <div class="controls">
                    <button class="btn btn-primary" data-action="refresh-chats">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn btn-success" data-action="start-parser">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–µ—Ä</button>
                    <button class="btn btn-danger" data-action="stop-parser">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä</button>
                </div>

                <div id="status"></div>
            </div>

            <!-- –ß–∞—Ç—ã -->
            <div id="chats" class="tab-pane">
                <h2>üí¨ –î–æ—Å—Ç—É–ø–Ω—ã–µ —á–∞—Ç—ã Telegram</h2>
                <p style="color: #5f6368; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</p>
                <div class="controls">
                    <button class="btn" data-action="refresh-chats">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
                <div id="chats-content"></div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ -->
            <div id="chat-management" class="tab-pane">
                <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–º–∏ —á–∞—Ç–∞–º–∏</h2>
                
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞ -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —á–∞—Ç –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 200px; gap: 15px; align-items: end;">
                        <div class="form-group">
                            <label for="chatId">ID —á–∞—Ç–∞:</label>
                            <input type="text" id="chatId" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: -1001234567890">
                        </div>
                        <div class="form-group">
                            <label for="keywords">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</label>
                            <input type="text" id="keywords" class="form-control" placeholder="–≥—Ä—É–∑, –ø–µ—Ä–µ–≤–æ–∑–∫–∞, –¥–æ—Å—Ç–∞–≤–∫–∞">
                        </div>
                        <div class="form-group">
                            <button onclick="addChat()" class="btn btn-success" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —á–∞—Ç–æ–≤ -->
                <h3>üìã –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —á–∞—Ç—ã</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>ID —á–∞—Ç–∞</th>
                            <th>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="monitored-chats-table">
                        <tr>
                            <td colspan="4" class="info">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div id="messages" class="tab-pane">
                <h2>üì® –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
                <div class="controls">
                    <button class="btn" onclick="loadMessages()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</button>
                </div>
                <div id="messages-content"></div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –î–û Firebase) -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    window.API_BASE = '';
        window.chatsConfig = [];

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò - –û–ü–†–ï–î–ï–õ–Ø–ï–ú –°–†–ê–ó–£
        window.showTab = function(tabName) {
            try {
                console.log('showTab –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è:', tabName);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
                if (tabName === 'chat-management') {
                    if (window.loadMonitoredChats) {
                        window.loadMonitoredChats();
                    }
                } else if (tabName === 'dashboard') {
                    if (window.loadStatus) window.loadStatus();
                    if (window.loadChats) window.loadChats();
                } else if (tabName === 'messages') {
                    if (window.loadMessages) {
                        window.loadMessages();
                    }
                } else if (tabName === 'chats') {
                    if (window.loadChats) {
                        window.loadChats();
                    }
                }
                
                console.log('showTab –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –¥–ª—è:', tabName);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏:', error);
            }
        };

        window.refreshChats = function() {
            try {
                console.log('refreshChats –≤—ã–∑–≤–∞–Ω–∞');
                if (window.loadChats) {
                    window.loadChats();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ refreshChats:', error);
            }
        };

        window.startParser = async function() {
            try {
                console.log('–ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞...');
                const response = await fetch(`${window.API_BASE}/api/parser/start`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    if (window.loadStatus) window.loadStatus();
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        window.stopParser = async function() {
            try {
                console.log('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞...');
                const response = await fetch(`${window.API_BASE}/api/parser/stop`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    if (window.loadStatus) window.loadStatus();
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        window.loadStatus = async function() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...');
                const response = await fetch(`${window.API_BASE}/api/status`);
                const status = await response.json();
                
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.innerHTML = `
                        <div class="info-card">
                            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
                            <p><strong>–ü–∞—Ä—Å–µ—Ä:</strong> ${status.parser_status === 'running' ? 'üü¢ –†–∞–±–æ—Ç–∞–µ—Ç' : 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}</p>
                            <p><strong>–í—Å–µ–≥–æ —á–∞—Ç–æ–≤:</strong> ${status.total_chats || 0}</p>
                            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤:</strong> ${status.active_chats || 0}</p>
                        </div>
                    `;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('totalMessages').textContent = status.total_messages || 0;
                document.getElementById('activeChats').textContent = status.active_chats || 0;
                document.getElementById('todayMessages').textContent = status.today_messages || 0;
                document.getElementById('errorCount').textContent = status.error_count || 0;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        };

        window.loadChats = async function() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...');
                const response = await fetch(`${window.API_BASE}/api/chats/all`);
                const chats = await response.json();
                
                const chatsElement = document.getElementById('chats-content');
                if (chatsElement) {
                    if (chats.length === 0) {
                        chatsElement.innerHTML = '<div class="info-card">üì≠ –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∞—Ç–æ–≤</div>';
                    } else {
                        chatsElement.innerHTML = `
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>ID</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${chats.map(chat => `
                                        <tr>
                                            <td><strong>${chat.title || chat.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —á–∞—Ç'}</strong></td>
                                            <td><code>${chat.id}</code></td>
                                            <td>${chat.type}</td>
                                            <td>${chat.participants_count || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</td>
                                            <td>
                                                ${chat.is_monitored ? 
                                                    '<span style="color: #34a853;">‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è</span>' : 
                                                    '<span style="color: #5f6368;">‚ö´ –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è</span>'
                                                }
                                            </td>
                                            <td>
                                                ${chat.is_monitored ? 
                                                    `<button class="btn btn-danger btn-sm" onclick="quickRemoveChat('${chat.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` :
                                                    `<button class="btn btn-success btn-sm" onclick="quickAddChat('${chat.id}', '${chat.title || chat.username || '–ß–∞—Ç'}')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>`
                                                }
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
                const chatsElement = document.getElementById('chats-content');
                if (chatsElement) {
                    chatsElement.innerHTML = '<div class="error-card">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤</div>';
                }
            }
        };

        window.loadMessages = async function() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...');
                const response = await fetch(`${window.API_BASE}/api/messages/recent`);
                const messages = await response.json();
                
                const messagesElement = document.getElementById('messages-content');
                if (messagesElement) {
                    if (messages.length === 0) {
                        messagesElement.innerHTML = '<div class="info-card">üì≠ –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
                    } else {
                        messagesElement.innerHTML = `
                            <div style="display: grid; gap: 15px;">
                                ${messages.map(msg => {
                                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è - –ø—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞
                                    let senderDisplay = msg.sender_name || msg.sender_id || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                                    
                                    if (msg.sender_username) {
                                        // –ï—Å–ª–∏ –µ—Å—Ç—å username - –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ (–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)
                                        senderDisplay = `<a href="https://t.me/${msg.sender_username}" target="_blank" style="color: #1a73e8; text-decoration: none; background: #e3f2fd; padding: 4px 8px; border-radius: 6px; font-weight: bold;">üí¨ ${msg.sender_name || msg.sender_username}</a>`;
                                    } else if (msg.sender_id) {
                                        // –ï—Å–ª–∏ –Ω–µ—Ç username - –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ ID
                                        const userName = msg.sender_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                                        senderDisplay = `<a href="tg://openmessage?user_id=${msg.sender_id}" target="_blank" style="color: #1a73e8; text-decoration: none; background: #e3f2fd; padding: 4px 8px; border-radius: 6px; font-weight: bold;">ÔøΩ ${userName}</a>`;
                                    }
                                    
                                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
                                    let processedMessage = msg.text || msg.message || '';
                                    
                                    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫ WhatsApp –∏ Telegram –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                                    function createPhoneLinks(phone) {
                                        let cleanPhone = phone.replace(/[^\d+]/g, '');
                                        
                                        // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ +
                                        if (cleanPhone.startsWith('8')) {
                                            cleanPhone = '+' + cleanPhone.substring(1);
                                        }
                                        // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7, –¥–æ–±–∞–≤–ª—è–µ–º +
                                        else if (cleanPhone.startsWith('7')) {
                                            cleanPhone = '+' + cleanPhone;
                                        }
                                        
                                        return `
                                            <div style="display: inline-flex; gap: 5px; align-items: center; background: #e8f5e8; padding: 4px 8px; border-radius: 6px; margin: 2px;">
                                                <span style="color: #137333; font-weight: bold;">üìû ${phone}</span>
                                                <a href="https://web.whatsapp.com/send?phone=${cleanPhone.replace('+', '')}" target="_blank" style="background: #25D366; color: white; padding: 2px 6px; border-radius: 4px; text-decoration: none; font-size: 12px;">WhatsApp</a>
                                                <a href="https://t.me/${cleanPhone}" target="_blank" style="background: #0088cc; color: white; padding: 2px 6px; border-radius: 4px; text-decoration: none; font-size: 12px;">Telegram</a>
                                            </div>
                                        `;
                                    }
                                    
                                    // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (—É–ª—É—á—à–µ–Ω–Ω–æ–µ)
                                    const phoneRegex = /(\+?[7-8][\s\-\(\)]?\d{3}[\s\-\(\)]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}|\+?[7-8]\d{10})/g;
                                    processedMessage = processedMessage.replace(phoneRegex, (phone) => {
                                        return createPhoneLinks(phone);
                                    });
                                    
                                    // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π @username
                                    const mentionRegex = /@(\w+)/g;
                                    processedMessage = processedMessage.replace(mentionRegex, (match, username) => {
                                        return `<a href="https://t.me/${username}" target="_blank" style="color: #1a73e8; text-decoration: none; background: #e3f2fd; padding: 2px 6px; border-radius: 4px;">${match}</a>`;
                                    });
                                    
                                    // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ <br>
                                    processedMessage = processedMessage.replace(/\n/g, '<br>');
                                    
                                    // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç—ã
                                    const messageDate = msg.timestamp || msg.date || msg.created_at;
                                    const formattedDate = messageDate ? new Date(messageDate).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                                    
                                    return `
                                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #1a73e8; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                            <div style="margin-bottom: 10px;">
                                                <strong style="color: #1a73e8;">üí¨ –ß–∞—Ç: ${msg.chat_title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —á–∞—Ç'}</strong>
                                                <span style="color: #5f6368; margin-left: 10px;">üìÖ –î–∞—Ç–∞: ${formattedDate}</span>
                                            </div>
                                            <div style="margin-bottom: 10px;">
                                                <strong>üë§ –ê–≤—Ç–æ—Ä:</strong> ${senderDisplay}
                                            </div>
                                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; line-height: 1.5;">
                                                <strong>üìù –¢–µ–∫—Å—Ç:</strong><br>
                                                ${processedMessage}
                                            </div>
                                            ${msg.keywords_found && msg.keywords_found.length > 0 ? `
                                                <div style="margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                                                    <strong>üîë –í–∞—à–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> 
                                                    <span style="color: #137333;">${msg.keywords_found.join(', ')}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
                const messagesElement = document.getElementById('messages-content');
                if (messagesElement) {
                    messagesElement.innerHTML = '<div class="error-card">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
                }
            }
        };

        window.loadMonitoredChats = async function() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —á–∞—Ç–æ–≤...');
                const response = await fetch(`${window.API_BASE}/api/chats/monitored`);
                const data = await response.json();
                
                window.chatsConfig = data.chats || [];
                window.renderMonitoredChatsTable();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —á–∞—Ç–æ–≤:', error);
                document.getElementById('monitored-chats-table').innerHTML = 
                    '<tr><td colspan="4" class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
        };

        window.renderMonitoredChatsTable = function() {
            const tbody = document.getElementById('monitored-chats-table');
            if (!tbody) return;
            
            if (window.chatsConfig.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #5f6368;">–ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —á–∞—Ç–æ–≤</td></tr>';
                return;
            }
            
            tbody.innerHTML = window.chatsConfig.map(chat => `
                <tr>
                    <td><strong>${chat.title || chat.username || chat.chat_id}</strong></td>
                    <td><code>${chat.chat_id}</code></td>
                    <td>${(chat.keywords || []).join(', ') || '–ù–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤'}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="removeChat('${chat.chat_id}')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </td>
                </tr>
            `).join('');
        };

        window.addChat = async function() {
            const chatId = document.getElementById('chatId').value.trim();
            const keywords = document.getElementById('keywords').value.trim();
            
            if (!chatId) {
                alert('‚ùå –í–≤–µ–¥–∏—Ç–µ ID —á–∞—Ç–∞');
                return;
            }
            
            try {
                const response = await fetch(`${window.API_BASE}/api/chats/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        keywords: keywords ? keywords.split(',').map(k => k.trim()) : []
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    document.getElementById('chatId').value = '';
                    document.getElementById('keywords').value = '';
                    window.loadMonitoredChats();
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        window.removeChat = async function(chatId) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —á–∞—Ç ${chatId}?`)) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/api/chats/remove`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    window.loadMonitoredChats();
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        // –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        window.quickAddChat = async function(chatId, chatName) {
            try {
                const keywords = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö):');
                const keywordsList = keywords ? keywords.split(',').map(k => k.trim()) : [];
                
                const response = await fetch(`${window.API_BASE}/api/chats/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        keywords: keywordsList
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    window.loadChats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                    window.loadMonitoredChats(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —á–∞—Ç—ã
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        // –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        window.quickRemoveChat = async function(chatId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —á–∞—Ç –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞?')) return;
            
            try {
                const response = await fetch(`${window.API_BASE}/api/chats/remove`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    window.loadChats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤  
                    window.loadMonitoredChats(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —á–∞—Ç—ã
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('[data-tab]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    if (window.showTab) {
                        window.showTab(tabName);
                    }
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
            document.querySelectorAll('[data-action]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.getAttribute('data-action');
                    
                    switch(action) {
                        case 'refresh-chats':
                            if (window.refreshChats) window.refreshChats();
                            break;
                        case 'start-parser':
                            if (window.startParser) window.startParser();
                            break;
                        case 'stop-parser':
                            if (window.stopParser) window.stopParser();
                            break;
                    }
                });
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            if (window.loadStatus) window.loadStatus();
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });

        console.log('‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é');
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Telegram
        window.openTelegramUser = function(username) {
            console.log('üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram:', username);
            
            // –ü—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            const desktopUrl = `tg://resolve?domain=${username}`;
            const webUrl = `https://t.me/${username}`;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π iframe –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = desktopUrl;
            document.body.appendChild(iframe);
            
            // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é
            setTimeout(() => {
                document.body.removeChild(iframe);
                window.open(webUrl, '_blank');
            }, 1000);
        };
        
        window.openTelegramByIdAndName = function(userId, userName) {
            console.log('üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –ø–æ ID –∏ –∏–º–µ–Ω–∏:', userId, userName);
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const desktopUrls = [
                `tg://resolve?id=${userId}`,
                `tg://user?id=${userId}`,
                `tg://openmessage?user_id=${userId}`
            ];
            
            let urlIndex = 0;
            let desktopWorked = false;
            
            function tryNextDesktopUrl() {
                if (urlIndex < desktopUrls.length) {
                    console.log(`–ü–æ–ø—ã—Ç–∫–∞ ${urlIndex + 1}: ${desktopUrls[urlIndex]}`);
                    
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = desktopUrls[urlIndex];
                    document.body.appendChild(iframe);
                    
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                        urlIndex++;
                        
                        // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π URL —á–µ—Ä–µ–∑ 300ms
                        if (urlIndex < desktopUrls.length) {
                            setTimeout(tryNextDesktopUrl, 300);
                        } else if (!desktopWorked) {
                            // –ï—Å–ª–∏ –≤—Å–µ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é
                            openWebTelegramWithName(userId, userName);
                        }
                    }, 600);
                } else {
                    openWebTelegramWithName(userId, userName);
                }
            }
            
            function openWebTelegramWithName(userId, userName) {
                console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é Telegram –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userName);
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é Telegram
                const webUrl = 'https://web.telegram.org/k/';
                window.open(webUrl, '_blank');
                
                // –ö–æ–ø–∏—Ä—É–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞
                const searchText = userName;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(searchText).then(() => {
                        setTimeout(() => {
                            alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: "${userName}"\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –≤ Telegram –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞.\n\n–¢–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–∫–∞—Ç—å –ø–æ ID: ${userId}`);
                        }, 1000);
                    }).catch(() => {
                        setTimeout(() => {
                            alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏: "${userName}"\n–ò–ª–∏ –ø–æ ID: ${userId}`);
                        }, 1000);
                    });
                } else {
                    setTimeout(() => {
                        alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏: "${userName}"\n–ò–ª–∏ –ø–æ ID: ${userId}`);
                    }, 1000);
                }
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ URL
            tryNextDesktopUrl();
        };
        
        window.openTelegramById = function(userId) {
            console.log('üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –ø–æ ID:', userId);
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const desktopUrls = [
                `tg://resolve?id=${userId}`,
                `tg://user?id=${userId}`,
                `tg://openmessage?user_id=${userId}`
            ];
            
            let urlIndex = 0;
            
            function tryNextDesktopUrl() {
                if (urlIndex < desktopUrls.length) {
                    console.log(`–ü–æ–ø—ã—Ç–∫–∞ ${urlIndex + 1}: ${desktopUrls[urlIndex]}`);
                    
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = desktopUrls[urlIndex];
                    document.body.appendChild(iframe);
                    
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                        urlIndex++;
                        
                        // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π URL —á–µ—Ä–µ–∑ 500ms
                        if (urlIndex < desktopUrls.length) {
                            setTimeout(tryNextDesktopUrl, 500);
                        } else {
                            // –ï—Å–ª–∏ –≤—Å–µ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é
                            openWebTelegram(userId);
                        }
                    }, 800);
                } else {
                    openWebTelegram(userId);
                }
            }
            
            function openWebTelegram(userId) {
                console.log('–û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é Telegram –¥–ª—è ID:', userId);
                
                // –î–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –ø–æ–ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ - –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–µ–º Telegram
                // –∏ —Å–∫–æ–ø–∏—Ä—É–µ–º ID –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                const webUrl = 'https://web.telegram.org/k/';
                window.open(webUrl, '_blank');
                
                // –ü–æ–ø—ã—Ç–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(userId).then(() => {
                        setTimeout(() => {
                            alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞: ${userId}\n–í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –ø–æ–∏—Å–∫ Telegram (@${userId} –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ ${userId})`);
                        }, 1000);
                    }).catch(() => {
                        setTimeout(() => {
                            alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID: ${userId}\n(–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ${userId})`);
                        }, 1000);
                    });
                } else {
                    setTimeout(() => {
                        alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID: ${userId}\n(–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: ${userId})`);
                    }, 1000);
                }
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ URL
            tryNextDesktopUrl();
        };
        
        window.openTelegramSearch = function(searchName) {
            console.log('üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –≤ Telegram:', searchName);
            
            // –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –ø–æ–∏—Å–∫ –≤ Telegram
            const webUrl = `https://t.me/`;
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ –∏–º–µ–Ω–∏
            window.open(webUrl, '_blank');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            setTimeout(() => {
                alert(`Telegram –æ—Ç–∫—Ä—ã—Ç! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –¥–ª—è: "${decodeURIComponent(searchName)}"`);
            }, 500);
        };
        
        window.openTelegramPhone = function(phone) {
            console.log('üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –≤ Telegram:', phone);
            
            // –ü—Ä–æ–±—É–µ–º –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            const desktopUrl = `tg://resolve?phone=${phone}`;
            const webUrl = `https://t.me/${phone}`;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π iframe –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = desktopUrl;
            document.body.appendChild(iframe);
            
            // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–≤–µ—Ä—Å–∏—é
            setTimeout(() => {
                document.body.removeChild(iframe);
                window.open(webUrl, '_blank');
            }, 1000);
        };
    </script>
</body>
</html>