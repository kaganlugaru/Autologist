<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π Autologist</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            padding: 20px; 
            background: #f5f7fa;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h1 { color: #1a73e8; margin-bottom: 30px; }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #1a73e8;
        }
        button { 
            margin: 5px; 
            padding: 10px 20px; 
            background: #1a73e8; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #1557b0; }
        button.danger { background: #ea4335; }
        button.danger:hover { background: #d93025; }
        button.success { background: #34a853; }
        button.success:hover { background: #2d8f3f; }
        #result { 
            margin-top: 20px; 
            padding: 15px; 
            background: #fff; 
            border-radius: 8px;
            border: 1px solid #e1e8ed;
            min-height: 200px;
        }
        .success { color: #34a853; font-weight: 500; }
        .error { color: #ea4335; font-weight: 500; }
        .info { color: #1a73e8; }
        pre { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π Autologist</h1>
        
        <div class="test-section">
            <h3>üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <button onclick="testShowTab()">–¢–µ—Å—Ç showTab</button>
            <button onclick="testRefreshChats()">–¢–µ—Å—Ç refreshChats</button>
            <button onclick="testLoadStatus()">–¢–µ—Å—Ç loadStatus</button>
        </div>

        <div class="test-section">
            <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–æ–º</h3>
            <button class="success" onclick="testStartParser()">–ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞</button>
            <button class="danger" onclick="testStopParser()">–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞</button>
        </div>

        <div class="test-section">
            <h3>üî¨ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã</h3>
            <button onclick="testAllFunctions()">–¢–µ—Å—Ç –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π</button>
            <button onclick="testAPIConnection()">–¢–µ—Å—Ç API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</button>
            <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
        window.API_BASE = 'http://localhost:8080';
        
        // –ú–æ–¥–µ–ª–∏—Ä—É–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        function createMockElement(id) {
            return {
                id: id,
                textContent: 'Mock ' + id,
                innerHTML: 'Mock ' + id,
                classList: {
                    add: (cls) => console.log(`‚úì –î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∞—Å—Å "${cls}" –∫ —ç–ª–µ–º–µ–Ω—Ç—É "${id}"`),
                    remove: (cls) => console.log(`‚úì –£–¥–∞–ª–µ–Ω –∫–ª–∞—Å—Å "${cls}" –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞ "${id}"`)
                }
            };
        }

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ DOM
        const originalGetElementById = document.getElementById;
        document.getElementById = function(id) {
            const real = originalGetElementById.call(document, id);
            return real || createMockElement(id);
        };

        const originalQuerySelectorAll = document.querySelectorAll;
        document.querySelectorAll = function(selector) {
            const real = originalQuerySelectorAll.call(document, selector);
            if (real.length === 0) {
                return [createMockElement('mock1'), createMockElement('mock2')];
            }
            return real;
        };

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.showTab = function(tabName) {
            try {
                addResult(`üéØ showTab("${tabName}") –≤—ã–∑–≤–∞–Ω–∞`, 'success');
                
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });
                
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                const targetTab = document.getElementById(tabName);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                addResult(`‚úÖ –í–∫–ª–∞–¥–∫–∞ "${tabName}" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞`, 'success');
                return true;
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ showTab: ${error.message}`, 'error');
                return false;
            }
        };
        
        window.refreshChats = function() {
            try {
                addResult('üîÑ refreshChats() –≤—ã–∑–≤–∞–Ω–∞', 'info');
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                setTimeout(() => {
                    addResult('‚úÖ –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                }, 500);
                return true;
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ refreshChats: ${error.message}`, 'error');
                return false;
            }
        };
        
        window.loadStatus = async function() {
            try {
                addResult('üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã...', 'info');
                const response = await fetch(`${API_BASE}/api/status`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                    addResult(`–°—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–µ—Ä–∞: ${data.parser.status}`, 'info');
                    addResult(`–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${data.stats.total_messages}`, 'info');
                    return true;
                } else {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ API: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ loadStatus: ${error.message}`, 'error');
                return false;
            }
        };

        window.startParser = async function() {
            try {
                addResult('‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä...', 'info');
                const response = await fetch(`${API_BASE}/api/parser/start`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    addResult(`‚úÖ ${result.message}`, 'success');
                    return true;
                } else {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ startParser: ${error.message}`, 'error');
                return false;
            }
        };

        window.stopParser = async function() {
            try {
                addResult('‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä—Å–µ—Ä...', 'info');
                const response = await fetch(`${API_BASE}/api/parser/stop`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    addResult(`‚úÖ ${result.message}`, 'success');
                    return true;
                } else {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ stopParser: ${error.message}`, 'error');
                return false;
            }
        };
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function addResult(text, type = 'info') {
            const result = document.getElementById('result');
            const p = document.createElement('p');
            p.className = type;
            p.innerHTML = `[${new Date().toLocaleTimeString()}] ${text}`;
            result.appendChild(p);
            result.scrollTop = result.scrollHeight;
        }

        function testShowTab() {
            addResult('=== –¢–ï–°–¢ showTab ===', 'info');
            showTab('dashboard');
            showTab('messages');
            showTab('chat-management');
        }
        
        function testRefreshChats() {
            addResult('=== –¢–ï–°–¢ refreshChats ===', 'info');
            refreshChats();
        }
        
        async function testLoadStatus() {
            addResult('=== –¢–ï–°–¢ loadStatus ===', 'info');
            await loadStatus();
        }

        async function testStartParser() {
            addResult('=== –¢–ï–°–¢ startParser ===', 'info');
            await startParser();
        }

        async function testStopParser() {
            addResult('=== –¢–ï–°–¢ stopParser ===', 'info');
            await stopParser();
        }

        async function testAPIConnection() {
            addResult('=== –¢–ï–°–¢ API –°–û–ï–î–ò–ù–ï–ù–ò–Ø ===', 'info');
            
            try {
                const statusResponse = await fetch(`${API_BASE}/api/status`);
                addResult(`Status API: ${statusResponse.ok ? '‚úÖ OK' : '‚ùå FAIL'}`, statusResponse.ok ? 'success' : 'error');
                
                const chatsResponse = await fetch(`${API_BASE}/api/chats`);
                addResult(`Chats API: ${chatsResponse.ok ? '‚úÖ OK' : '‚ùå FAIL'}`, chatsResponse.ok ? 'success' : 'error');
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API: ${error.message}`, 'error');
            }
        }

        async function testAllFunctions() {
            addResult('üß™ === –ü–û–õ–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï ===', 'info');
            
            const tests = [
                { name: 'showTab', fn: () => testShowTab() },
                { name: 'refreshChats', fn: () => testRefreshChats() },
                { name: 'loadStatus', fn: () => testLoadStatus() },
                { name: 'API Connection', fn: () => testAPIConnection() }
            ];

            for (let test of tests) {
                try {
                    addResult(`üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º: ${test.name}`, 'info');
                    await test.fn();
                    await new Promise(resolve => setTimeout(resolve, 500)); // –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
                } catch (error) {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ ${test.name}: ${error.message}`, 'error');
                }
            }

            addResult('üéâ === –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û ===', 'success');
        }
        
        function clearResults() {
            document.getElementById('result').innerHTML = '';
            addResult('üßπ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            addResult('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            addResult('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: showTab, refreshChats, loadStatus, startParser, stopParser', 'info');
            addResult('üí° –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π', 'info');
        });
    </script>
</body>
</html>